<!doctype html>
<html lang="zh-TW" class="h-full">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>æ¡Œè™ŸæŸ¥è©¢ç³»çµ±</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap">

  <style>
    *, *::before, *::after {
      box-sizing: border-box;
      font-family: 'Noto Sans TC', system-ui, -apple-system, sans-serif;
    }
    .fade-in { animation: fadeIn 0.3s ease-in; }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>

<body class="h-full">
  <div id="app" class="w-full h-full"></div>

  <script>
    // ============================================================
    // ğŸ”´ å·²å¹«ä½ å¡«å¥½ï¼šGoogle Sheet IDï¼ˆä¸ç”¨å†æ”¹ï¼‰
    // ============================================================
    const GOOGLE_SHEET_ID = "1GDtxQPMryH3_q998dz4p4oZA8kuz8And1RwwakbvjYA";

    // è‹¥ä½ åªæœ‰ä¸€å€‹åˆ†é ï¼Œé€™è¡Œç¶­æŒç©ºç™½å³å¯
    const GOOGLE_SHEET_TAB_NAME = "";

    // ============================================================
    // UI è¨­å®š
    // ============================================================
    const config = {
      background_color: '#0f172a',
      surface_color: '#1e293b',
      text_color: '#f1f5f9',
      primary_action_color: '#3b82f6',
      secondary_action_color: '#64748b',
      font_size: 16,
      app_title: 'æ¡Œè™ŸæŸ¥è©¢'
    };

    let allEmployeeData = [];
    let isLoading = true;
    let autoClearTimer = null;

    function escapeHtml(s) {
      return String(s)
        .replaceAll('&','&amp;')
        .replaceAll('<','&lt;')
        .replaceAll('>','&gt;')
        .replaceAll('"','&quot;')
        .replaceAll("'","&#39;");
    }

    function sheetUrl() {
      let base = `https://docs.google.com/spreadsheets/d/${GOOGLE_SHEET_ID}/gviz/tq?tqx=out:json`;
      if (GOOGLE_SHEET_TAB_NAME) {
        base += `&sheet=${encodeURIComponent(GOOGLE_SHEET_TAB_NAME)}`;
      }
      return base + `&_=${Date.now()}`;
    }

    async function loadData() {
      const res = await fetch(sheetUrl(), { cache: 'no-store' });
      const text = await res.text();
      const json = JSON.parse(
        text.substring(text.indexOf('{'), text.lastIndexOf('}') + 1)
      );

      const cols = json.table.cols.map(c => c.label);
      const rows = json.table.rows;

      allEmployeeData = rows.map(r => {
        const obj = {};
        r.c.forEach((cell, i) => obj[cols[i]] = cell?.v ?? '');
        return {
          employee_id: String(obj.employee_id || obj['å“¡å·¥ç·¨è™Ÿ'] || '').trim(),
          desk_number: String(obj.desk_number || obj['æ¡Œè™Ÿ'] || '').trim()
        };
      }).filter(r => r.employee_id && r.desk_number);

      isLoading = false;
      render();
    }

    function render() {
      const app = document.getElementById('app');
      const f = config.font_size;

      app.innerHTML = `
        <div class="min-h-full flex items-center justify-center p-6" style="background:${config.background_color};color:${config.text_color}">
          <div class="w-full max-w-md">
            <div class="text-center mb-6">
              <h1 style="font-size:${f*2}px;font-weight:700">${config.app_title}</h1>
              <div style="font-size:${f*0.85}px;opacity:.8">è³‡æ–™ä¾†æºï¼šGoogle Sheetï¼ˆå…¨è£ç½®åŒæ­¥ï¼‰</div>
            </div>

            <div class="p-6 rounded-lg" style="background:${config.surface_color}">
              <div style="font-size:${f*0.85}px;opacity:.8;margin-bottom:${f}px">
                ç›®å‰è³‡æ–™ç­†æ•¸ï¼š${allEmployeeData.length}
              </div>

              <input id="eid" type="text" placeholder="è«‹è¼¸å…¥å“¡å·¥ç·¨è™Ÿ"
                style="width:100%;padding:${f}px;border-radius:8px;border:none;margin-bottom:${f}px;font-size:${f*1.1}px">

              <div style="display:flex;gap:${f}px">
                <button onclick="query()" style="flex:1;background:${config.primary_action_color};color:white;padding:${f}px;border-radius:8px">æŸ¥è©¢</button>
                <button onclick="resetQ()" style="flex:1;background:${config.secondary_action_color};color:white;padding:${f}px;border-radius:8px">é‡è¨­</button>
              </div>

              <div id="result" style="margin-top:${f}px"></div>

              ${isLoading ? `<div style="margin-top:${f}px;opacity:.7">è³‡æ–™è¼‰å…¥ä¸­â€¦</div>` : ``}
            </div>

            <div class="text-center" style="margin-top:${f}px;font-size:${f*0.8}px;opacity:.7">
              ç®¡ç†è€…è«‹ç›´æ¥ç·¨è¼¯ Google Sheet
            </div>
          </div>
        </div>
      `;
    }

    function resetQ() {
      document.getElementById('eid').value = '';
      document.getElementById('result').innerHTML = '';
    }

    function query() {
      const id = document.getElementById('eid').value.trim();
      const res = document.getElementById('result');
      if (!id) return;

      clearTimeout(autoClearTimer);

      const found = allEmployeeData.find(r => r.employee_id === id);
      if (found) {
        res.innerHTML = `<div class="fade-in" style="padding:12px;border-left:4px solid ${config.primary_action_color}">
          åº§ä½ï¼š<strong style="font-size:1.4em">${escapeHtml(found.desk_number)}</strong>
        </div>`;
      } else {
        res.innerHTML = `<div class="fade-in" style="padding:12px;border-left:4px solid #ef4444">
          æŸ¥ç„¡æ­¤å“¡å·¥
        </div>`;
      }

      autoClearTimer = setTimeout(() => res.innerHTML = '', 3000);
    }

    render();
    loadData();
  </script>
</body>
</html>
